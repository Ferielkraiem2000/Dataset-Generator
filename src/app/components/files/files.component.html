<nz-content>
  <ng-container *ngIf="isDownloadView()">
    <p class="title-card" *ngIf="isDownloadView();else noView ">Download Combined manifest file</p>
    <ng-template #noView>
      <p class="title-cardprog">Download Combined manifest file</p>
    </ng-template>
  </ng-container>
  <div class="glass-effect shadow">
    <ng-container *ngIf="isDownloadView()">
      <input nz-input placeholder="Tap the file's path" [(ngModel)]="path" class="input" />
      <div>
        <nz-select [(ngModel)]="selectedFormat" [nzPlaceHolder]="'Select Format'" class="select">
          <nz-option nzValue="ESPnet" nzLabel="ESPnet"></nz-option>
          <nz-option nzValue="JSON" nzLabel="JSON"></nz-option>
          <nz-option nzValue="CSV" nzLabel="CSV"></nz-option>
        </nz-select>
      </div>
      <div>
        <button class="button-glass" nz-button nzType="primary"
          (click)="selectedFormat?openProgressView():showTapMessage()">Download</button>
      </div>
    </ng-container>
    <ng-container *ngIf="isProgressView()">
      <div class="download-container">
        <img src="./assets/download.png" class="file-icon">
        <div class="download-info">
          <nz-progress [nzPercent]="percent" *ngIf="!isCanceled ;else CancelDone"></nz-progress>
          <ng-template #CancelDone>
            <nz-progress [nzPercent]="percent" nzStatus="exception"></nz-progress>
          </ng-template>
          <div> <span class="download-text">downloading...</span> </div>
          <div>
            <button class="cancel-button" (click)="cancelDownload()" *ngIf="!isCanceled"
              [disabled]="percent === 100">Cancel</button>
            <button class="continue-button" (click)="openProgressView()" *ngIf="isCanceled">Continue</button>

          </div>
        </div>
      </div>
    </ng-container>

  </div>
  <p class="title-card">Selected Files Statistics</p>
  <div class="row">
    <div class="col-lg-3 col-md-6 col-sm-6">
      <div *ngIf="selectedStatistics.length > 0; else noStatistics" class="container">
        <ng-container *ngFor="let stat of selectedStatistics">
          <nz-card class="custom-card">
            <div class="card-header card-header-warning card-header-icon">
              <div class="card-icon-top-left" style="background-color:rgb(190, 44, 151);">
                <i nz-icon nzType="pie-chart" class="centered-icon"></i>
              </div>

              <p class="card-title">Segments</p>
              <p class="value">{{ stat.segmentCount }}</p>
            </div>
          </nz-card>
          <nz-card class="custom-card">
            <div class="card-header card-header-warning card-header-icon">
              <div class="card-icon-top-left" style="background-color: blue">
                <i nz-icon nzType="sound" class="centered-icon"></i>
              </div>

              <p class="card-title">Speakers</p>
              <p class="value">{{ stat.speakerCount }}</p>
            </div>
          </nz-card>
          <nz-card class="custom-card">
            <div class="card-header card-header-warning card-header-icon">
              <div class="card-icon-top-left" style="background-color: rgb(86, 188, 228)">
                <i nz-icon nzType="clock-circle" class="centered-icon"></i>
              </div>
              <p class="card-title">Total Duration (s)</p>
              <p class="value">{{ stat.totalDuration }}</p>
            </div>
          </nz-card>
          <nz-card class="custom-card">
            <div class="card-header card-header-warning card-header-icon">
              <div class="card-icon-top-left" style="background-color:rgb(243, 97, 197);">
                <i nz-icon nzType="clock-circle" class="centered-icon"></i>
              </div>
              <p class="card-title">Average Duration (s)</p>
              <p class="value">{{ stat.averageDuration }}</p>
            </div>
          </nz-card>
        </ng-container>
      </div>
      <ng-template #noStatistics>
        <div class="container">
          <ng-container>
            <nz-card class="custom-card">
              <div class="card-header card-header-warning card-header-icon">
                <div class="card-icon-top-left" style="background-color:rgb(190, 44, 151);">
                  <i nz-icon nzType="pie-chart" class="centered-icon"></i>
                </div>
                <p class="card-title">Segments</p>
                <p class="value">__</p>
              </div>
            </nz-card>
            <nz-card class="custom-card">
              <div class="card-header card-header-warning card-header-icon">
                <div class="card-icon-top-left" style="background-color: blue">
                  <i nz-icon nzType="sound" class="centered-icon"></i>
                </div>
                <p class="card-title">Speakers</p>
                <p class="value">__</p>
              </div>
            </nz-card>
            <nz-card class="custom-card">
              <div class="card-header card-header-warning card-header-icon">
                <div class="card-icon-top-left" style="background-color: rgb(86, 188, 228)">
                  <i nz-icon nzType="clock-circle" class="centered-icon"></i>
                </div>
                <p class="card-title">Total Duration (s)</p>
                <p class="value">__</p>
              </div>
            </nz-card>
            <nz-card class="custom-card">
              <div class="card-header card-header-warning card-header-icon">
                <div class="card-icon-top-left" style="background-color:rgb(243, 97, 197);">
                  <i nz-icon nzType="clock-circle" class="centered-icon"></i>
                </div>
                <p class="card-title">Average Duration (s)</p>
                <p class="value">__</p>
              </div>
            </nz-card>
          </ng-container>
        </div>
      </ng-template>
    </div>
  </div>

  <p class="title-file">Files</p>

  <div class="tools">
    <button nz-icon nzType="download" class="download-button" (click)="openView()"></button>
    <button class="delete-button" nz-icon nzType="delete"
      (click)=" this.isSelectedStats().length>1 ?showMultipleDeletionAlert():showSelectMessage()"></button>
    <input type="text" [(ngModel)]="searchFileName" *ngIf="isSearchButtonClicked"
      placeholder="Search by Audio File Name" class="searchInput" />
    <button nz-icon nzType="search" (click)="searchByFileName()" class="searchButton"></button>
  </div>

  <div class="custom-container">
    <table class="custom-table">
      <thead>
        <tr>
          <th class="text-center"></th>
          <th>File Name</th>
          <th>Total Duration (s)</th>
          <th class="text-center">Average Duration (s)</th>
          <th>Number Of Segments</th>
          <th class="text-center">Number Of Speakers</th>
          <th style="width: 17%;">Upload Time</th>
          <th>Actions</th>

        </tr>
      </thead>
      <tbody>
        <ng-container *ngIf="statisticsPerPage.length > 0; else noStatisticsPerPage">

          <tr *ngFor="let stat of statisticsPerPage" [ngClass]="{ 'selected-row': isSelected(stat) }">
            <td class="text-center">
              <input type="checkbox" [checked]="isSelected(stat)" (change)="toggleSelection(stat) ">
            </td>
            <td>
              <span *ngIf="!editMode ">{{ stat.fileName.length <= 20 ? stat.fileName : stat.fileName.slice(0, 20)
                  + '...' }}</span>
                  <div *ngIf="editMode && isSelected(stat)">
                    <input [(ngModel)]="newFileName" />
                    <button nz-icon nzType="check" (click)="onConfirm(stat)" style="margin-left:10%"></button>
                    <button nz-icon nzType="close" style="margin-left:12%" (click)="onCancel()"></button>
                  </div>
                  <i nz-icon nzType="edit" [ngClass]="{}"
                    (click)="this.isSelectedStats().length==1 && this.isSelected(stat)?onIconClick(stat):showSelectFileMessage()" style=" margin-right:1.18px;"
                    *ngIf="!editMode"></i>
            </td>
            <td>{{ stat.totalDuration }}</td>
            <td class="text-center">{{ stat.averageDuration }}</td>
            <td>{{ stat.segmentCount }}</td>
            <td class="text-center">{{ stat.speakerCount }}</td>
            <td>{{ stat.uploadTime }} </td>
            <td>
              <i nz-icon nzType="delete" [ngClass]="{}" style="margin-right: 6px;"
                (click)=" this.isSelectedStats().length == 1 && this.isSelected(stat) ?showDeletionAlert(stat):showSelectFileMessage()"></i>
              <i nz-icon nzType="download" [ngClass]="{}" 
                (click)="this.isSelectedStats().length == 1 && this.isSelected(stat)?openFormatSelectionDialog():showSelectFileMessage()"
                style=" margin-right:1.18px;"></i>
              <i nz-icon nzType="eye" [ngClass]="{}"
                (click)="this.isSelectedStats().length==1 && this.isSelected(stat)?showContent(stat):showSelectFileMessage ()" ></i>
            </td>
          </tr>
        </ng-container>
        <ng-template #noStatisticsPerPage>
          <tr>
            <td colspan="8" class="no-results-message">No result to be displayed</td>
          </tr>
        </ng-template>
      </tbody>

    </table>
  </div>
  <ng-container *ngIf="this.statisticsPerPage.length>0 ;else noPages">
    <div class="pagination-controls">
      <button (click)="changePage(-1)" [disabled]="currentPage === 1">
        <i nz-icon nzType="left" nzTheme="outline"></i>
      </button>
      <span> {{ currentPage }} / {{ totalPages }} </span>
      <button (click)="changePage(1)" [disabled]="currentPage === totalPages">
        <i nz-icon nzType="right" nzTheme="outline"></i>
      </button>
    </div>
  </ng-container>
  <ng-template #noPages>

  </ng-template>
  <p class="title-histogram">Histogram of Selected Files</p>
  <div class="slider-container" *ngIf="combinedHistogramData != null && this.isSelectedStats().length>0">
    <input type="range" min="0.5" max="20.0" step="0.5" [(ngModel)]="sliderValue" (ngModelChange)="updateSliderValue()"
      class="slider">
    <div class="slider-value" *ngIf="sliderClicked">Interval Size : {{ sliderValue }}</div>
  </div>


  <ng-container *ngIf="combinedHistogramData != null && this.isSelectedStats().length > 0; else noHistogramData">
    <div class="chart-container">
      <ngx-charts-bar-vertical [view]="[1100, 600]" [results]="single" [xAxis]="true" [yAxis]="true"
        [showXAxisLabel]="true" [showYAxisLabel]="true" [xAxisLabel]="'Duration'"
        [yAxisLabel]="'Segment count'"></ngx-charts-bar-vertical>
    </div>
  </ng-container>

  <ng-template #noHistogramData>
    <div class="chart-container">
      <p class="noDataText">No Data to be displayed</p>
      <ngx-charts-bar-vertical [view]="[1200, 600]" [results]="noDataResult" [scheme]="colorScheme" [xAxis]="true"
        [yAxis]="true" [showXAxisLabel]="true" [showYAxisLabel]="true" [xAxisLabel]="'Duration'"
        [yAxisLabel]="'Segment count'" [yScaleMax]="1000" class="bar">

      </ngx-charts-bar-vertical>
    </div>
  </ng-template>


</nz-content>